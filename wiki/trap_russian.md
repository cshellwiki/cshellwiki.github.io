# [Linux] Bash trap использование: Обработка сигналов и очистка ресурсов

## Обзор
Команда `trap` в Bash используется для обработки сигналов и выполнения заданных действий при получении этих сигналов. Это позволяет разработчикам управлять поведением скриптов при возникновении определённых событий, таких как прерывание выполнения или выход из программы.

## Использование
Базовый синтаксис команды `trap` выглядит следующим образом:

```bash
trap [действие] [сигналы]
```

## Общие параметры
- `SIGINT`: Сигнал прерывания (обычно отправляется при нажатии Ctrl+C).
- `SIGTERM`: Сигнал завершения, который отправляется процессу для его завершения.
- `EXIT`: Действие, которое выполняется при выходе из скрипта.
- `ERR`: Действие, которое выполняется при возникновении ошибки в скрипте.

## Общие примеры

### Пример 1: Обработка SIGINT
```bash
trap 'echo "Скрипт прерван"; exit' SIGINT
while true; do
    echo "Работаю..."
    sleep 1
done
```
В этом примере, если пользователь нажмет Ctrl+C, скрипт выведет сообщение и завершится.

### Пример 2: Очистка ресурсов при выходе
```bash
trap 'rm -f /tmp/tempfile; echo "Временный файл удалён"' EXIT
touch /tmp/tempfile
echo "Работаю с временным файлом..."
```
Этот скрипт создаёт временный файл и удаляет его при выходе.

### Пример 3: Обработка ошибок
```bash
trap 'echo "Произошла ошибка!"' ERR
false  # Эта команда всегда завершится с ошибкой
```
В этом примере, если команда `false` завершится с ошибкой, будет выведено сообщение.

## Советы
- Используйте `trap` для обеспечения корректного завершения скриптов и освобождения ресурсов.
- Обрабатывайте сигналы, которые могут быть отправлены пользователем, чтобы улучшить взаимодействие со скриптом.
- Помните, что порядок указания сигналов в команде `trap` имеет значение; если один и тот же сигнал указан несколько раз, будет выполнено последнее действие.